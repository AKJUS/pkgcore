#!/usr/bin/env pkgcore-sh-helper
# open a package's homepage in a browser
#
# For queries returning multiple packages, a list of options is presented to
# the user to choose from. In the same manner, if a package has multiple
# homepages listed, a list of homepages is outputted for selection.
#
# Note that this requires xdg-utils to be installed for xdg-open.

# Default to the current working directory if no argument is passed so psite
# can be run with no arguments from within an ebuild's directory.
if [[ $# -eq 0 ]]; then
	set -- "${PWD}" "$@"
elif [[ $1 == "-h" || $1 == "--help" ]]; then
	cat <<-EOF
		psite: open a package's homepage in a browser
		usage: psite pkg [repo]
		example: psite gcc -- open gcc's HOMEPAGE in a browser
		example: psite coreutils gentoo -- open the coreutils::gentoo HOMEPAGE
	EOF
	exit
fi

homepage=( $(_pkgattr homepage "$@") )

if [[ -z ${homepage[@]} ]]; then
	exit 1
elif [[ ${#homepage[@]} -gt 1 ]]; then
	echo "Multiple homepages found:"
	choice=$(_choose "${homepage[@]}")
	[[ $? -ne 0 ]] && exit 1
	homepage=${homepage[choice]}
fi

if ! _which xdg-open; then
	echo "xdg-open missing, install xdg-utils"
	return 1
fi

xdg-open "${homepage}" &>/dev/null &
